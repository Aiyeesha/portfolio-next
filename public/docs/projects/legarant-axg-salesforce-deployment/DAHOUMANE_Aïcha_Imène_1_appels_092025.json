{
	"info": {
		"_postman_id": "decf70e1-8e60-4b83-8069-119163303547",
		"name": "LEGARANT AXG Prod (Apex REST + Tests v3 auto-id)",
		"description": "Collection Postman pour endpoints Apex REST custom avec tests. Auto-renseigne {{idOrExt}} en pre-request depuis les variables last* (collection/env).",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "38309383"
	},
	"item": [
		{
			"name": "Contacts (Apex REST)",
			"item": [
				{
					"name": "POST Contact",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Fixed the syntax errors",
									"// Supporte 201 (created) ou 200 (existing)",
									"pm.test(\"Status 200/201\", function () {",
									"  pm.expect([200,201]).to.include(pm.response.code);",
									"});",
									"let json = {};",
									"try { json = pm.response.json() || {}; } catch(e) { json = {}; }",
									"let cid = json.id || json.contactId;",
									"",
									"if (cid) {",
									"  pm.collectionVariables.set(\"lastContactId\", cid);",
									"  pm.environment.set(\"lastContactId\", cid);",
									"  pm.variables.set(\"lastContactId\", cid); // request-scope fallback",
									"}",
									"if (json.externalId || null) {",
									"  pm.collectionVariables.set(\"lastContactExt\", json.externalId || null);",
									"  pm.environment.set(\"lastContactExt\", json.externalId || null);",
									"  pm.variables.set(\"lastContactExt\", json.externalId || null); // request-scope fallback",
									"}",
									"// Facilite la requête suivante (GET/PATCH/DELETE) sans saisir idOrExt",
									"if (cid) pm.variables.set(\"idOrExt\", cid);",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"LastName\": \"axG -tests Contact Test\",\n  \"city\" : \"Berlin\",\n  \"Email\": \"test.Contact@example.com\"\n}"
						},
						"url": {
							"raw": "{{instance_url}}/services/apexrest/v1/contacts",
							"host": [
								"{{instance_url}}"
							],
							"path": [
								"services",
								"apexrest",
								"v1",
								"contacts"
							]
						},
						"description": "Crée un contact ou retourne l'existant si email déjà présent"
					},
					"response": []
				},
				{
					"name": "GET Contact",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"type": "text/javascript",
								"exec": [
									"",
									"// Auto-résolution de {idOrExt} pour Contact",
									"let provided = pm.variables.get(\"idOrExt\");",
									"if (!provided) {",
									"  let id = pm.collectionVariables.get(\"lastContactExt\") ",
									"        || pm.collectionVariables.get(\"lastContactId\")",
									"        || pm.environment.get(\"lastContactExt\")",
									"        || pm.environment.get(\"lastContactId\");",
									"  if (id) {",
									"    pm.variables.set(\"idOrExt\", id);",
									"  }",
									"}",
									""
								]
							}
						},
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"",
									"pm.test(\"GET Contact 200\", function () {",
									"  pm.response.to.have.status(200);",
									"});",
									"var c = pm.response.json() || {};",
									"",
									"if (c.id) {",
									"  pm.collectionVariables.set(\"lastContactId\", c.id);",
									"  pm.environment.set(\"lastContactId\", c.id);",
									"  pm.variables.set(\"lastContactId\", c.id); // request-scope fallback",
									"}",
									"if (c.externalId) {",
									"  pm.collectionVariables.set(\"lastContactExt\", c.externalId);",
									"  pm.environment.set(\"lastContactExt\", c.externalId);",
									"  pm.variables.set(\"lastContactExt\", c.externalId); // request-scope fallback",
									"}",
									""
								]
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"url": {
							"raw": "{{instance_url}}/services/apexrest/v1/contacts/{{idOrExt}}",
							"host": [
								"{{instance_url}}"
							],
							"path": [
								"services",
								"apexrest",
								"v1",
								"contacts",
								"{{idOrExt}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "PATCH Contact",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"",
									"// Auto-résolution de {idOrExt} pour Contact",
									"let provided = pm.variables.get(\"idOrExt\");",
									"if (!provided) {",
									"  let id = pm.collectionVariables.get(\"lastContactExt\") ",
									"        || pm.collectionVariables.get(\"lastContactId\")",
									"        || pm.environment.get(\"lastContactExt\")",
									"        || pm.environment.get(\"lastContactId\");",
									"  if (id) {",
									"    pm.variables.set(\"idOrExt\", id);",
									"  }",
									"}",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"",
									"pm.test(\"PATCH Contact 200\", function () {",
									"  pm.response.to.have.status(200);",
									"});",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "PATCH",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"MobilePhone\": \"+491111\"\n}"
						},
						"url": {
							"raw": "{{instance_url}}/services/apexrest/v1/contacts/{{lastContactExt}}",
							"host": [
								"{{instance_url}}"
							],
							"path": [
								"services",
								"apexrest",
								"v1",
								"contacts",
								"{{lastContactExt}}"
							]
						},
						"description": "Mise à jour d'un contact"
					},
					"response": []
				},
				{
					"name": "DELETE Contact (désactive)",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"",
									"// Auto-résolution de {idOrExt} pour Contact",
									"let provided = pm.variables.get(\"idOrExt\");",
									"if (!provided) {",
									"  let id = pm.collectionVariables.get(\"lastContactExt\") ",
									"        || pm.collectionVariables.get(\"lastContactId\")",
									"        || pm.environment.get(\"lastContactExt\")",
									"        || pm.environment.get(\"lastContactId\");",
									"  if (id) {",
									"    pm.variables.set(\"idOrExt\", id);",
									"  }",
									"}",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"",
									"// Vérifie 200 puis GET pour confirmer Active__c=false",
									"pm.test(\"DELETE Contact 200\", function () {",
									"  pm.response.to.have.status(200);",
									"});",
									"let target = pm.variables.get(\"idOrExt\") || pm.collectionVariables.get(\"lastContactExt\") || pm.collectionVariables.get(\"lastContactId\") || pm.environment.get(\"lastContactExt\") || pm.environment.get(\"lastContactId\");",
									"if (target) {",
									"  pm.sendRequest({",
									"    url: pm.variables.replaceIn(\"{{instance_url}}/services/apexrest/v1/contacts/\" + target),",
									"    method: \"GET\",",
									"    header: { \"Authorization\": \"Bearer \" + pm.variables.get(\"access_token\") }",
									"  }, (err, res) => {",
									"    pm.test(\"Vérif désactivation (GET après DELETE)\", function () {",
									"      pm.expect(err).to.eql(null);",
									"      pm.expect(res.code).to.eql(200);",
									"      const body = res.json() || {};",
									"      pm.expect(body).to.have.property(\"active\", false);",
									"    });",
									"  });",
									"}",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "PATCH",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\r\n  \"Active\": \"false\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{instance_url}}/services/apexrest/v1/contacts/{{lastContactId}}",
							"host": [
								"{{instance_url}}"
							],
							"path": [
								"services",
								"apexrest",
								"v1",
								"contacts",
								"{{lastContactId}}"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "Accounts (Apex REST)",
			"item": [
				{
					"name": "POST Account",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"",
									"pm.test(\"POST Account 201/200\", function () {",
									"  pm.expect([200,201]).to.include(pm.response.code);",
									"});",
									"let j = {};",
									"try { j = pm.response.json() || {}; } catch(e) { j = {}; }",
									"",
									"if (j.id) {",
									"  pm.collectionVariables.set(\"lastAccountId\", j.id);",
									"  pm.environment.set(\"lastAccountId\", j.id);",
									"  pm.variables.set(\"lastAccountId\", j.id); // request-scope fallback",
									"}",
									"if (j.externalId or null) {",
									"  pm.collectionVariables.set(\"lastAccountExt\", j.externalId or null);",
									"  pm.environment.set(\"lastAccountExt\", j.externalId or null);",
									"  pm.variables.set(\"lastAccountExt\", j.externalId or null); // request-scope fallback",
									"}",
									"if (j.id) pm.variables.set(\"idOrExt\", j.id);",
									""
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"Name\": \"AXG GmbH\",\n  \"Phone\": \"12345\"\n}"
						},
						"url": {
							"raw": "{{instance_url}}/services/apexrest/v1/accounts",
							"host": [
								"{{instance_url}}"
							],
							"path": [
								"services",
								"apexrest",
								"v1",
								"accounts"
							]
						},
						"description": "Crée un compte"
					},
					"response": []
				},
				{
					"name": "GET Account",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"type": "text/javascript",
								"exec": [
									"",
									"// Auto-résolution de {idOrExt} pour Account",
									"let provided = pm.variables.get(\"idOrExt\");",
									"if (!provided) {",
									"  let id = pm.collectionVariables.get(\"lastAccountExt\") ",
									"        || pm.collectionVariables.get(\"lastAccountId\")",
									"        || pm.environment.get(\"lastAccountExt\")",
									"        || pm.environment.get(\"lastAccountId\");",
									"  if (id) {",
									"    pm.variables.set(\"idOrExt\", id);",
									"  }",
									"}",
									""
								]
							}
						},
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"",
									"pm.test(\"GET Account 200\", function () {",
									"  pm.response.to.have.status(200);",
									"});",
									"let a = pm.response.json() || {};",
									"",
									"if (a.id) {",
									"  pm.collectionVariables.set(\"lastAccountId\", a.id);",
									"  pm.environment.set(\"lastAccountId\", a.id);",
									"  pm.variables.set(\"lastAccountId\", a.id); // request-scope fallback",
									"}",
									"if (a.externalId) {",
									"  pm.collectionVariables.set(\"lastAccountExt\", a.externalId);",
									"  pm.environment.set(\"lastAccountExt\", a.externalId);",
									"  pm.variables.set(\"lastAccountExt\", a.externalId); // request-scope fallback",
									"}",
									""
								]
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"url": {
							"raw": "{{instance_url}}/services/apexrest/v1/accounts/{{idOrExt}}",
							"host": [
								"{{instance_url}}"
							],
							"path": [
								"services",
								"apexrest",
								"v1",
								"accounts",
								"{{idOrExt}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "PATCH Account",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"",
									"// Auto-résolution de {idOrExt} pour Account",
									"let provided = pm.variables.get(\"idOrExt\");",
									"if (!provided) {",
									"  let id = pm.collectionVariables.get(\"lastAccountExt\") ",
									"        || pm.collectionVariables.get(\"lastAccountId\")",
									"        || pm.environment.get(\"lastAccountExt\")",
									"        || pm.environment.get(\"lastAccountId\");",
									"  if (id) {",
									"    pm.variables.set(\"idOrExt\", id);",
									"  }",
									"}",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"",
									"pm.test(\"PATCH Account 200\", function () {",
									"  pm.response.to.have.status(200);",
									"});",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "PATCH",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"Website\": \"https://axg.de\"\n}"
						},
						"url": {
							"raw": "{{instance_url}}/services/apexrest/v1/accounts/{{lastAccountExt}}",
							"host": [
								"{{instance_url}}"
							],
							"path": [
								"services",
								"apexrest",
								"v1",
								"accounts",
								"{{lastAccountExt}}"
							]
						},
						"description": "Mise à jour d'un compte"
					},
					"response": []
				}
			]
		},
		{
			"name": "Contracts (Apex REST)",
			"item": [
				{
					"name": "POST Contract",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"",
									"pm.test(\"POST Contract 201/200\", function () {",
									"  pm.expect([200,201]).to.include(pm.response.code);",
									"});",
									"let c = {};",
									"try { c = pm.response.json() || {}; } catch(e) { c = {}; }",
									"",
									"if (c.id) {",
									"  pm.collectionVariables.set(\"lastContractId\", c.id);",
									"  pm.environment.set(\"lastContractId\", c.id);",
									"  pm.variables.set(\"lastContractId\", c.id); // request-scope fallback",
									"}",
									"if (c.externalId or null) {",
									"  pm.collectionVariables.set(\"lastContractExt\", c.externalId or null);",
									"  pm.environment.set(\"lastContractExt\", c.externalId or null);",
									"  pm.variables.set(\"lastContractExt\", c.externalId or null); // request-scope fallback",
									"}",
									"if (c.id) pm.variables.set(\"idOrExt\", c.id);",
									""
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"AccountId\": \"{{axgAccountId}}\",\n  \"Status\": \"Draft\",\n  \"StartDate\": \"2025-01-01\",\n  \"ContractTerm\": 12\n}"
						},
						"url": {
							"raw": "{{instance_url}}/services/apexrest/v1/contracts",
							"host": [
								"{{instance_url}}"
							],
							"path": [
								"services",
								"apexrest",
								"v1",
								"contracts"
							]
						},
						"description": "Crée un contrat avec calcul du ContractTerm"
					},
					"response": []
				},
				{
					"name": "GET Contract",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"type": "text/javascript",
								"exec": [
									"",
									"// Auto-résolution de {idOrExt} pour Contract",
									"let provided = pm.variables.get(\"idOrExt\");",
									"if (!provided) {",
									"  let id = pm.collectionVariables.get(\"lastContractExt\") ",
									"        || pm.collectionVariables.get(\"lastContractId\")",
									"        || pm.environment.get(\"lastContractExt\")",
									"        || pm.environment.get(\"lastContractId\");",
									"  if (id) {",
									"    pm.variables.set(\"idOrExt\", id);",
									"  }",
									"}",
									""
								]
							}
						},
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"",
									"pm.test(\"GET Contract 200\", function () {",
									"  pm.response.to.have.status(200);",
									"});",
									"let k = pm.response.json() || {};",
									"",
									"if (k.id) {",
									"  pm.collectionVariables.set(\"lastContractId\", k.id);",
									"  pm.environment.set(\"lastContractId\", k.id);",
									"  pm.variables.set(\"lastContractId\", k.id); // request-scope fallback",
									"}",
									"if (k.externalId) {",
									"  pm.collectionVariables.set(\"lastContractExt\", k.externalId);",
									"  pm.environment.set(\"lastContractExt\", k.externalId);",
									"  pm.variables.set(\"lastContractExt\", k.externalId); // request-scope fallback",
									"}",
									""
								]
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"url": {
							"raw": "{{instance_url}}/services/apexrest/v1/contracts/{{idOrExt}}",
							"host": [
								"{{instance_url}}"
							],
							"path": [
								"services",
								"apexrest",
								"v1",
								"contracts",
								"{{idOrExt}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "PATCH Contract",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"",
									"// Auto-résolution de {idOrExt} pour Contract",
									"let provided = pm.variables.get(\"idOrExt\");",
									"if (!provided) {",
									"  let id = pm.collectionVariables.get(\"lastContractExt\") ",
									"        || pm.collectionVariables.get(\"lastContractId\")",
									"        || pm.environment.get(\"lastContractExt\")",
									"        || pm.environment.get(\"lastContractId\");",
									"  if (id) {",
									"    pm.variables.set(\"idOrExt\", id);",
									"  }",
									"}",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"",
									"pm.test(\"PATCH Contract 200\", function () {",
									"  pm.response.to.have.status(200);",
									"});",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "PATCH",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"Description\": \"Mis \\u00e0 jour\"\n}"
						},
						"url": {
							"raw": "{{instance_url}}/services/apexrest/v1/contracts/{{lastContractExt}}",
							"host": [
								"{{instance_url}}"
							],
							"path": [
								"services",
								"apexrest",
								"v1",
								"contracts",
								"{{lastContractExt}}"
							]
						},
						"description": "Mise à jour d'un contrat"
					},
					"response": []
				}
			]
		},
		{
			"name": "Utils",
			"item": [
				{
					"name": "DEBUG – Show Vars",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"",
									"console.log(\"ENV last* vars\", {",
									"  lastContactId: pm.environment.get(\"lastContactId\"),",
									"  lastContactExt: pm.environment.get(\"lastContactExt\"),",
									"  lastAccountId: pm.environment.get(\"lastAccountId\"),",
									"  lastAccountExt: pm.environment.get(\"lastAccountExt\"),",
									"  lastContractId: pm.environment.get(\"lastContractId\"),",
									"  lastContractExt: pm.environment.get(\"lastContractExt\"),",
									"});",
									"console.log(\"COLL last* vars\", {",
									"  lastContactId: pm.collectionVariables.get(\"lastContactId\"),",
									"  lastContactExt: pm.collectionVariables.get(\"lastContactExt\"),",
									"  lastAccountId: pm.collectionVariables.get(\"lastAccountId\"),",
									"  lastAccountExt: pm.collectionVariables.get(\"lastAccountExt\"),",
									"  lastContractId: pm.collectionVariables.get(\"lastContractId\"),",
									"  lastContractExt: pm.collectionVariables.get(\"lastContractExt\"),",
									"});",
									"pm.test(\"Vars visibles dans la console\", function(){ pm.expect(true).to.be.true; });",
									""
								]
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"url": {
							"raw": "{{instance_url}}/services/data/v59.0/limits",
							"host": [
								"{{instance_url}}"
							],
							"path": [
								"services",
								"data",
								"v59.0",
								"limits"
							]
						}
					},
					"response": []
				},
				{
					"name": "DEBUG – Clear Vars",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"",
									"['lastContactId','lastContactExt','lastAccountId','lastAccountExt','lastContractId','lastContractExt','idOrExt'].forEach(k=>{",
									"  pm.collectionVariables.unset(k);",
									"  pm.environment.unset(k);",
									"  pm.variables.unset(k);",
									"});",
									"pm.test(\"Vars cleared\", function(){ pm.expect(true).to.be.true; });",
									""
								]
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"url": {
							"raw": "{{instance_url}}/services/data/v59.0/limits",
							"host": [
								"{{instance_url}}"
							],
							"path": [
								"services",
								"data",
								"v59.0",
								"limits"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "Auth - Get Access Token (client_credentials)",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"let data = pm.response.json();\r",
							"pm.environment.set(\"access_token\", data.access_token);\r",
							"pm.environment.set(\"instance_url\", data.instance_url);\r",
							"pm.environment.set(\"token_type\", \"Bearer\");"
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							"const must = [\"api_version\",\"access_token\"];\r",
							"const miss = must.filter(k => !pm.environment.get(k));\r",
							"if (miss.length && pm.request.url.toString().includes('/oauth2/token') === false) {\r",
							"  pm.execution.setNextRequest(null);\r",
							"  throw new Error(\"Variables manquantes: \" + miss.join(\", \"));\r",
							"}\r",
							"// Authorization auto si absent\r",
							"if (!pm.request.headers.has(\"Authorization\") && pm.environment.get(\"access_token\")) {\r",
							"  pm.request.headers.add({ key: \"Authorization\", value: `${pm.environment.get(\"token_type\")||\"Bearer\"} ${pm.environment.get(\"access_token\")}` });\r",
							"}\r",
							""
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [],
				"body": {
					"mode": "urlencoded",
					"urlencoded": [
						{
							"key": "grant_type",
							"value": "client_credentials",
							"type": "text"
						},
						{
							"key": "client_id",
							"value": "{{client_id}}",
							"type": "text"
						},
						{
							"key": "client_secret",
							"value": "{{client_secret}}",
							"type": "text"
						}
					]
				},
				"url": {
					"raw": "{{instance_url}}/services/oauth2/token",
					"host": [
						"{{instance_url}}"
					],
					"path": [
						"services",
						"oauth2",
						"token"
					]
				}
			},
			"response": []
		},
		{
			"name": "Auth - Get Access Token (Password-flow)",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"let data = pm.response.json();\r",
							"pm.environment.set(\"access_token\", data.access_token);\r",
							"pm.environment.set(\"instance_url\", data.instance_url);\r",
							"pm.environment.set(\"token_type\", \"Bearer\");"
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							"const must = [\"api_version\",\"access_token\"];\r",
							"const miss = must.filter(k => !pm.environment.get(k));\r",
							"if (miss.length && pm.request.url.toString().includes('/oauth2/token') === false) {\r",
							"  pm.execution.setNextRequest(null);\r",
							"  throw new Error(\"Variables manquantes: \" + miss.join(\", \"));\r",
							"}\r",
							"// Authorization auto si absent\r",
							"if (!pm.request.headers.has(\"Authorization\") && pm.environment.get(\"access_token\")) {\r",
							"  pm.request.headers.add({ key: \"Authorization\", value: `${pm.environment.get(\"token_type\")||\"Bearer\"} ${pm.environment.get(\"access_token\")}` });\r",
							"}\r",
							""
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [],
				"body": {
					"mode": "urlencoded",
					"urlencoded": [
						{
							"key": "grant_type",
							"value": "client_credentials",
							"type": "text"
						},
						{
							"key": "client_id",
							"value": "{{client_id}}",
							"type": "text"
						},
						{
							"key": "client_secret",
							"value": "{{client_secret}}",
							"type": "text"
						}
					]
				},
				"url": {
					"raw": "{{instance_url}}/services/oauth2/token",
					"host": [
						"{{instance_url}}"
					],
					"path": [
						"services",
						"oauth2",
						"token"
					]
				}
			},
			"response": []
		}
	]
}